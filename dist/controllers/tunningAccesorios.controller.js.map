{"version":3,"file":"tunningAccesorios.controller.js","names":["tunningController","getAll","req","res","TuningAccesorios","find","sort","producto","populate","path","select","poopulate","query","length","json","total","all","status","message","console","log","err","createOne","body","codigo_interno","sede","sedeE","clasificacion","pCosto","margenGanancia","stockInicial","pVenta","forCar","anio","anioE","estado","estadoE","createdBy","newObj","Sucursal","findOne","name","sedeFound","_id","ModeloTasaciones","$in","forCarFound","map","a","Anio","anioFound","EstadoTunningAccesorio","estadoFound","User","username","userFound","save","updateOneById","itemId","params","findByIdAndUpdate","findByEstado","$regex","countDocuments"],"sources":["../../src/controllers/tunningAccesorios.controller.js"],"sourcesContent":["import TuningAccesorios from '../models/TuningAccesorios';\r\nimport ModeloTasaciones from '../models/ModeloTasaciones';\r\nimport Anio from '../models/Anio';\r\nimport EstadoTunningAccesorio from '../models/EstadoTunningAccesorio';\r\nimport User from '../models/User';\r\nimport Sucursal from '../models/Sucursal';\r\n\r\nconst tunningController = {};\r\n\r\ntunningController.getAll = async (req, res) => {\r\n    try {\r\n        const query = await TuningAccesorios.find()\r\n        .sort({producto: 1})\r\n        .populate({\r\n            path: 'forCar',\r\n            select: 'name avatar marca',\r\n            poopulate: {\r\n                path: 'marca',\r\n                select: 'name avatar'\r\n            }\r\n        })\r\n        .populate({\r\n            path: 'anioE',\r\n            select: 'name'\r\n        })\r\n        .populate({\r\n            path: 'sedeE',\r\n            select: 'name'\r\n        })\r\n        .populate({\r\n            path: 'estadoE',\r\n            select: 'name valor'\r\n        })\r\n        .populate({\r\n            path: 'createdBy',\r\n            select: 'name username'\r\n        });\r\n\r\n        if(query.length > 0){\r\n            res.json({total: query.length, all: query});\r\n        }else{\r\n            return res.status(404).json({message: `No existen registros de accesorios`});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({err: err, message: err.message});\r\n    }\r\n};\r\n\r\ntunningController.createOne = async (req, res) => {\r\n    const { codigo_interno,sede,sedeE, clasificacion, producto, pCosto, margenGanancia, stockInicial, pVenta, forCar, anio, anioE, estado, estadoE, createdBy} = req.body;\r\n    try {\r\n        const newObj = new TuningAccesorios({\r\n            codigo_interno,\r\n            sede,\r\n            clasificacion, \r\n            producto, \r\n            pCosto, \r\n            margenGanancia, \r\n            stockInicial, \r\n            pVenta,\r\n            anio,\r\n            estado\r\n        });\r\n\r\n        const sedeFound = await Sucursal.findOne({name: sedeE});\r\n        if(!sedeFound) return res.status(404).json({message: `Sede ${sedeE} no encontrado`});\r\n        newObj.sedeE = sedeFound._id;\r\n\r\n        const forCarFound = await ModeloTasaciones.find({name: {$in: forCar}});\r\n        if(!forCarFound) return res.status(404).json({message: `Modelo ${forCar} no encontrado`});\r\n        newObj.forCar = forCarFound.map(a => a._id);\r\n        \r\n        const anioFound = await Anio.find({name: anioE});\r\n        if(!anioFound) return res.status(404).json({message: `Año ${anioE} no encontrado`});\r\n        newObj.anioE = anioFound.map(a => a._id);\r\n        \r\n        const estadoFound = await EstadoTunningAccesorio.findOne({name: estadoE});\r\n        if(!estadoFound) return res.status(404).json({message: `Estado ${estadoE} no encontrado`});\r\n        newObj.estadoE = estadoFound._id;\r\n        \r\n        const userFound = await User.findOne({username: createdBy});\r\n        if(!userFound) return res.status(404).json({message: `Usuario ${createdBy} no encontrado`});\r\n        newObj.createdBy = userFound._id;\r\n\r\n        const query = await newObj.save();\r\n\r\n        if(query) res.json({message: 'Accesorio registrado con éxito'});\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({err: err, message: err.message});\r\n    }\r\n}\r\n\r\ntunningController.updateOneById = async (req, res) => {\r\n    const {estado, estadoE} = req.body;\r\n    const {itemId} = req.params;\r\n\r\n    try {\r\n        const estadoFound = await EstadoTunningAccesorio.findOne({name: estadoE});\r\n        if(!estadoFound) return res.status(404).json({message: `Estado ${estadoE} no encontrado`});\r\n        \r\n        const query = await TuningAccesorios.findByIdAndUpdate(itemId, {\r\n            estado,\r\n            estadoE: estadoFound._id\r\n        });\r\n\r\n        if(query){\r\n            res.json({message: `Registro actualizado con éxito`});\r\n        }else {\r\n            return res.status(404).json({ message: 'No existe registro a actualizar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({err: err, message: err.message});\r\n    }\r\n}\r\n\r\ntunningController.findByEstado = async(req, res) => {\r\n    const {estado} = req.body;\r\n\r\n    try {\r\n        const query = await TuningAccesorios.find({\r\n            estado: {$regex: \".*\" + estado + \".*\"}\r\n        }).countDocuments();\r\n\r\n        if(query >= 0){\r\n            res.json({total: query})\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ message: err.message });\r\n    }\r\n}\r\n\r\nexport default tunningController;"],"mappings":"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"}