{"version":3,"sources":["../../src/controllers/sale.controller.js"],"names":["createSale","req","res","body","vendedor","cliente","auto","serie_tdp","color","precio","anio_fabricacion","anio_modelo","ubicacion_vehiculo","estatus_vehiculo","tipo_financiamiento","entidad_bancaria","sustento","fecha_sustento","monto_aprobado","oficina","ejecutivo","montoAdelanto1","fechaAdelanto1","montoAdelanto2","fechaAdelanto2","montoAdelanto3","fechaAdelanto3","montoAdelanto4","fechaAdelanto4","montoAdelanto5","fechaAdelanto5","montoAdelanto6","fechaAdelanto6","montoAdelanto7","fechaAdelanto7","montoAdelanto8","fechaAdelanto8","campanias","observacion_adv","accesorios","condicion_accesorios","fecha_facturacion_tdp","estatus_facturacion","tipo_operacion","fecha_inicio_reserva","fecha_fin_reserva","tipo_comprobante","nro_comprobante","fecha_comprobante","estatus_venta","sucursal_venta","fecha_cancelacion","newSale","Sale","Seller","find","name","$in","foundSeller","map","seller","_id","Vehicle","cod_tdp","foundVehicle","vehicle","Customer","document","foundCustomer","customer","Campaign","foundCampaign","campaign","Props","foundProps","props","save","saleSaved","json","message","console","log","status","getSales","populate","ventasfull","getSaleById","salesId","params","findById","venta","send","updateSaleById","findByIdAndUpdate","ventaActualizada","deleteSaleById","findByIdAndDelete","deleteSale","UnidadesByStatus","estado","where","query","length","conteoUnidadesCanceladas","countDocuments","consulta","error","conteoUnidadesLibres","conteoTarapotoCanceladas","conteoJaenCanceladas","conteoTarapotoLibres","conteoJaenLibres","conteoVentasByVendedor","aggregate","$unwind","$group","num_ventas","$sum"],"mappings":"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","sourcesContent":["import Sale from '../models/Sale'\r\nimport Vehicle from '../models/Vehicle'\r\nimport Seller from '../models/Seller'\r\nimport Customer from '../models/Customer'\r\nimport Campaign from '../models/Campaign'\r\nimport Props from '../models/Props'\r\n\r\nexport const createSale = async(req, res) => {\r\n    try {\r\n        const { vendedor, cliente, auto, serie_tdp, color, precio, anio_fabricacion, anio_modelo, ubicacion_vehiculo, estatus_vehiculo, tipo_financiamiento, entidad_bancaria, sustento, fecha_sustento, monto_aprobado, oficina, ejecutivo, montoAdelanto1, fechaAdelanto1, montoAdelanto2, fechaAdelanto2, montoAdelanto3, fechaAdelanto3, montoAdelanto4, fechaAdelanto4, montoAdelanto5, fechaAdelanto5, montoAdelanto6, fechaAdelanto6, montoAdelanto7, fechaAdelanto7, montoAdelanto8, fechaAdelanto8, campanias, observacion_adv, accesorios, condicion_accesorios, fecha_facturacion_tdp, estatus_facturacion, tipo_operacion, fecha_inicio_reserva, fecha_fin_reserva, tipo_comprobante, nro_comprobante, fecha_comprobante, estatus_venta, sucursal_venta, fecha_cancelacion } = req.body;\r\n\r\n\r\n        const newSale = new Sale({ serie_tdp, color, precio, anio_fabricacion, anio_modelo, ubicacion_vehiculo, estatus_vehiculo, tipo_financiamiento, entidad_bancaria, sustento, fecha_sustento, monto_aprobado, oficina, ejecutivo, montoAdelanto1, fechaAdelanto1, montoAdelanto2, fechaAdelanto2, montoAdelanto3, fechaAdelanto3, montoAdelanto4, fechaAdelanto4, montoAdelanto5, fechaAdelanto5, montoAdelanto6, fechaAdelanto6, montoAdelanto7, fechaAdelanto7, montoAdelanto8, fechaAdelanto8, observacion_adv, condicion_accesorios, fecha_facturacion_tdp, estatus_facturacion, tipo_operacion, fecha_inicio_reserva, fecha_fin_reserva, tipo_comprobante, nro_comprobante, fecha_comprobante, estatus_venta, sucursal_venta, fecha_cancelacion });\r\n\r\n        //Seller\r\n        const foundSeller = await Seller.find({ name: { $in: vendedor } });\r\n        newSale.vendedor = foundSeller.map(seller => seller._id);\r\n\r\n        //Vehicle\r\n        const foundVehicle = await Vehicle.find({ cod_tdp: { $in: auto } });\r\n        newSale.auto = foundVehicle.map(vehicle => vehicle._id);\r\n\r\n        //Customer\r\n        const foundCustomer = await Customer.find({ document: { $in: cliente } });\r\n        newSale.cliente = foundCustomer.map(customer => customer._id);\r\n\r\n        //Campaign\r\n        const foundCampaign = await Campaign.find({ name: { $in: campanias } });\r\n        newSale.campanias = foundCampaign.map(campaign => campaign._id);\r\n\r\n        //Props\r\n        const foundProps = await Props.find({ name: { $in: accesorios } });\r\n        newSale.accesorios = foundProps.map(props => props._id);\r\n\r\n        //console.log(newSale);\r\n        const saleSaved = await newSale.save();\r\n        if (saleSaved) {\r\n            res.json({ message: 'Expediente creado con éxito' });\r\n        }\r\n    } catch (e) {\r\n        console.log(e);\r\n        res.status(403).json({ message: 'No autorizado' })\r\n    }\r\n}\r\n\r\nexport const getSales = async(req, res) => {\r\n    try {\r\n        const ventasfull = await Sale.find()\r\n            .populate('vendedor')\r\n            .populate('auto')\r\n            .populate('cliente')\r\n            .populate('campanias')\r\n            .populate('accesorios');\r\n\r\n        res.json(ventasfull);\r\n\r\n        //console.log(ventasfull)\r\n    } catch (e) {\r\n        console.log(e);\r\n        res.json({ message: 'Error interno' })\r\n    }\r\n}\r\n\r\nexport const getSaleById = async(req, res) => {\r\n    try {\r\n        const { salesId } = req.params;\r\n        const venta = await Sale.findById(salesId)\r\n            .populate('vendedor')\r\n            .populate('auto')\r\n            .populate('cliente')\r\n            .populate('campanias')\r\n            .populate('accesorios');\r\n\r\n        if (venta) {\r\n            res.send(venta);\r\n        }\r\n    } catch (e) {\r\n        console.log(e);\r\n        res.status(403).json({ message: 'No Autorizado' })\r\n    }\r\n}\r\n\r\nexport const updateSaleById = async(req, res) => {\r\n    try {\r\n        const { salesId } = req.params;\r\n\r\n        const { vendedor, cliente, auto, serie_tdp, color, precio, anio_fabricacion, anio_modelo, ubicacion_vehiculo, estatus_vehiculo, tipo_financiamiento, entidad_bancaria, sustento, fecha_sustento, monto_aprobado, oficina, ejecutivo, montoAdelanto1, fechaAdelanto1, montoAdelanto2, fechaAdelanto2, montoAdelanto3, fechaAdelanto3, montoAdelanto4, fechaAdelanto4, montoAdelanto5, fechaAdelanto5, montoAdelanto6, fechaAdelanto6, montoAdelanto7, fechaAdelanto7, montoAdelanto8, fechaAdelanto8, campanias, observacion_adv, accesorios, condicion_accesorios, fecha_facturacion_tdp, estatus_facturacion, tipo_operacion, fecha_inicio_reserva, fecha_fin_reserva, tipo_comprobante, nro_comprobante, fecha_comprobante, estatus_venta, sucursal_venta, fecha_cancelacion } = req.body;\r\n\r\n        //Seller\r\n        const foundSeller = await Seller.find({ name: { $in: vendedor } });\r\n\r\n        //Vehicle\r\n        const foundVehicle = await Vehicle.find({ cod_tdp: { $in: auto } });\r\n\r\n        //Customer\r\n        const foundCustomer = await Customer.find({ document: { $in: cliente } });\r\n\r\n        //Campaign\r\n        const foundCampaign = await Campaign.find({ name: { $in: campanias } });\r\n\r\n        //Props\r\n        const foundProps = await Props.find({ name: { $in: accesorios } });\r\n\r\n        const ventaActualizada = await Sale.findByIdAndUpdate(salesId, { vendedor: foundSeller.map(seller => seller._id), cliente: foundCustomer.map(customer => customer._id), auto: foundVehicle.map(vehicle => vehicle._id), serie_tdp, color, precio, anio_fabricacion, anio_modelo, ubicacion_vehiculo, estatus_vehiculo, tipo_financiamiento, entidad_bancaria, sustento, fecha_sustento, monto_aprobado, oficina, ejecutivo, montoAdelanto1, fechaAdelanto1, montoAdelanto2, fechaAdelanto2, montoAdelanto3, fechaAdelanto3, montoAdelanto4, fechaAdelanto4, montoAdelanto5, fechaAdelanto5, montoAdelanto6, fechaAdelanto6, montoAdelanto7, fechaAdelanto7, montoAdelanto8, fechaAdelanto8, campanias: foundCampaign.map(campaign => campaign._id), observacion_adv, accesorios: foundProps.map(props => props._id), condicion_accesorios, fecha_facturacion_tdp, estatus_facturacion, tipo_operacion, fecha_inicio_reserva, fecha_fin_reserva, tipo_comprobante, nro_comprobante, fecha_comprobante, estatus_venta, sucursal_venta, fecha_cancelacion });\r\n\r\n        if (ventaActualizada) {\r\n            //Mandamos la respuesta\r\n            res.json({ message: 'Expediente actualizado con éxito' });\r\n        } else {\r\n            //Mandamos la respuesta\r\n            res.status(403).json({ message: 'No Autorizado' });\r\n        }\r\n\r\n    } catch (e) {\r\n        console.log(e);\r\n        res.status(401).json({ message: 'Error interno' })\r\n    }\r\n}\r\n\r\nexport const deleteSaleById = async(req, res) => {\r\n    try {\r\n        const { salesId } = req.params;\r\n        const deleteSale = await Sale.findByIdAndDelete(salesId);\r\n\r\n        if (deleteSale) {\r\n            res.status(200).json({ message: 'Expediente eliminado con éxito' });\r\n        }\r\n    } catch (e) {\r\n        console.log(e);\r\n        res.status(401).json({ message: 'Error interno' })\r\n    }\r\n}\r\n\r\nexport const UnidadesByStatus = async(req, res) => {\r\n    const { estado } = req.params;\r\n    try {\r\n        const query = await Sale.where({ estatus_venta: estado }).find().populate('vendedor')\r\n            .populate('auto')\r\n            .populate('cliente')\r\n            .populate('campanias')\r\n            .populate('accesorios');\r\n        if (query.length > 0) {\r\n            res.json(query);\r\n        } else {\r\n            return res.status(201).json({ message: 'No existen Unidades' })\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        res.status(403).json({ message: 'No Autorizado' });\r\n    }\r\n}\r\n\r\nexport const conteoUnidadesCanceladas = async(req, res) => {\r\n    try {\r\n        const consulta = await Sale.where({ estatus_venta: 'Cancelado' }).countDocuments();\r\n        if (consulta > 0) {\r\n            res.json(consulta);\r\n        } else {\r\n            return res.status(201).json({ message: 'No existen Unidades Canceladas' });\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(403).json({ message: 'No Autorizado' })\r\n    }\r\n}\r\n\r\nexport const conteoUnidadesLibres = async(req, res) => {\r\n    try {\r\n        const consulta = await Sale.where({ estatus_venta: 'Libre' }).countDocuments();\r\n        if (consulta) {\r\n            res.json(consulta);\r\n        } else {\r\n            return res.status(201).json({ message: 'No existen Unidades Libres' })\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(403).json({ message: 'No Autorizado' })\r\n    }\r\n}\r\n\r\nexport const conteoTarapotoCanceladas = async(req, res) => {\r\n    try {\r\n        const consulta = await Sale.where({ estatus_venta: 'Cancelado', sucursal_venta: 'Tarapoto' }).countDocuments();\r\n        if (consulta) {\r\n            res.json(consulta);\r\n        } else {\r\n            return res.status(201).json({ message: 'No existen Unidades Canceladas en Tarapoto' })\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(403).json({ message: 'No Autorizado' })\r\n    }\r\n}\r\n\r\nexport const conteoJaenCanceladas = async(req, res) => {\r\n    try {\r\n        const consulta = await Sale.where({ estatus_venta: 'Cancelado', sucursal_venta: 'Jaén' }).countDocuments();\r\n        if (consulta) {\r\n            res.json(consulta);\r\n        } else {\r\n            return res.status(201).json({ message: 'No existen Unidades Canceladas en Jaén' })\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(403).json({ message: 'No Autorizado' })\r\n    }\r\n}\r\n\r\nexport const conteoTarapotoLibres = async(req, res) => {\r\n    try {\r\n        const consulta = await Sale.where({ estatus_venta: 'Libre', sucursal_venta: 'Tarapoto' }).countDocuments();\r\n        if (consulta) {\r\n            res.json(consulta);\r\n        } else {\r\n            return res.status(201).json({ message: 'No existen Unidades Libres en Tarapoto' })\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(403).json({ message: 'No Autorizado' })\r\n    }\r\n}\r\n\r\nexport const conteoJaenLibres = async(req, res) => {\r\n    try {\r\n        const consulta = await Sale.where({ estatus_venta: 'Libre', sucursal_venta: 'Jaén' }).countDocuments();\r\n        if (consulta) {\r\n            res.json(consulta);\r\n        } else {\r\n            return res.status(201).json({ message: 'No existen Unidades Libres en Jaén' })\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(403).json({ message: 'No Autorizado' })\r\n    }\r\n}\r\n\r\nexport const conteoVentasByVendedor = async(req, res) => {\r\n    try {\r\n        const consulta = await Sale.aggregate([{\r\n            $unwind: '$vendedor'\r\n        }, {\r\n            $group: {\r\n                _id: \"$vendedor\",\r\n                num_ventas: { $sum: 1 }\r\n            }\r\n        }]);\r\n        if (consulta) {\r\n            res.json(consulta);\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        res.status(403).json({ message: 'No Autorizado' });\r\n    }\r\n}"],"file":"sale.controller.js"}