{"version":3,"file":"accesorio.controller.js","names":["accesorioController","getAll","req","res","AccesorioE","find","sort","name","populate","path","select","query","length","json","total","all","status","message","console","log","getOne","accesorioId","params","findById","one","getAllActivos","estado","total_active","all_active","createOne","body","cod_interno","model","precio","createdBy","obj","ModeloTasaciones","findOne","modelFound","_id","User","username","userFound","save","updateById","findByIdAndUpdate","deleteById","findByIdAndDelete","getAccesoriosByModelo","modelo"],"sources":["../../src/controllers/accesorio.controller.js"],"sourcesContent":["import AccesorioE from '../models/AccesorioE';\r\nimport ModeloTasaciones from '../models/ModeloTasaciones'\r\nimport User from '../models/User';\r\n\r\nconst accesorioController = {};\r\n\r\naccesorioController.getAll = async (req, res) => {\r\n    try {\r\n        const query = await AccesorioE.find()\r\n        .sort({ name: 1})\r\n        .populate({\r\n            path: 'model',\r\n            select: 'name avatar marca',\r\n            populate: {\r\n                path: 'marca',\r\n                select: 'name avatar'\r\n            }\r\n        })\r\n        .populate({\r\n            path: 'createdBy',\r\n            select: 'name username'\r\n        });\r\n\r\n        if(query.length > 0){\r\n            res.json({total: query.length, all: query});\r\n        }else{\r\n            return res.status(404).json({message: 'No existen accesorios creados'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\naccesorioController.getOne = async (req, res) => {\r\n    const { accesorioId} = req.params;\r\n\r\n    try {\r\n        const query = await AccesorioE.findById(accesorioId)\r\n        .populate({\r\n            path: 'model',\r\n            select: 'name avatar marca',\r\n            populate: {\r\n                path: 'marca',\r\n                select: 'name avatar'\r\n            }\r\n        })\r\n        .populate({\r\n            path: 'createdBy',\r\n            select: 'name username'\r\n        });\r\n\r\n        if(query){\r\n            res.json({one: query});\r\n        }else{\r\n            return res.status(404).json({message: `No existe accesorio ${accesorioId}`});\r\n        }\r\n\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\naccesorioController.getAllActivos = async (req, res) => {\r\n    try {\r\n        const query = await AccesorioE.find({estado: true})\r\n        .sort({name: 1})\r\n        .populate({\r\n            path: 'model',\r\n            select: 'name avatar marca',\r\n            populate: {\r\n                path: 'marca',\r\n                select: 'name avatar'\r\n            }\r\n        })\r\n        .populate({\r\n            path: 'createdBy',\r\n            select: 'name username'\r\n        });\r\n\r\n        if (query.length > 0) {\r\n            res.json({total_active: query.length, all_active: query});\r\n        } else {\r\n            return res.status(404).json({ message: 'No hay accesorios activos' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\naccesorioController.createOne = async (req, res) => {\r\n    const { cod_interno, name, model, precio, estado, createdBy} = req.body;\r\n    try {\r\n        const obj = new AccesorioE({ cod_interno, name, precio, estado });\r\n\r\n        const modelFound = await ModeloTasaciones.findOne({name: model});\r\n        if(!modelFound) return res.status(404).json({message: `Modelo ${model} no encontrado`});\r\n        obj.model = modelFound._id;\r\n        \r\n        const userFound = await User.findOne({username: createdBy});\r\n        if(!userFound) return res.status(404).json({message: `Usuario ${createdBy} no encontrado`});\r\n        obj.createdBy = userFound._id;\r\n\r\n        const query = await obj.save();\r\n        if(query){\r\n            res.json({message: 'Accesorio creado con éxito'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\naccesorioController.updateById = async (req, res) => {\r\n    const {accesorioId} = req.params;\r\n    const { cod_interno, name, model, precio, estado } = req.body;\r\n    \r\n    try {\r\n\r\n        const modelFound = await ModeloTasaciones.findOne({name: model});\r\n        if(!modelFound) return res.status(404).json({message: `Modelo ${model} no encontrado`});\r\n\r\n        const query = await AccesorioE.findByIdAndUpdate(accesorioId, {\r\n            cod_interno, \r\n            name, \r\n            model: modelFound._id,\r\n            precio, \r\n            estado\r\n        });\r\n\r\n        if (query) {\r\n            res.json({ message: 'Accesorio actualizado con éxito' });\r\n        } else {\r\n            return res.status(404).json({ message: 'No existe accesorio a actualizar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\naccesorioController.deleteById = async (req, res) => {\r\n    const {accesorioId} = req.params;\r\n    try {\r\n        const query = await AccesorioE.findByIdAndDelete(accesorioId);\r\n        if (query) {\r\n            res.json({ message: 'Accesorio eliminado con éxito' });\r\n        } else {\r\n            return res.status(404).json({ message: 'No existe accesorio a eliminar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\naccesorioController.getAccesoriosByModelo = async (req, res) => {\r\n    const { modelo } = req.body;\r\n\r\n    try {\r\n        const modelFound = await ModeloTasaciones.findOne({name: modelo});\r\n\r\n        const query = await AccesorioE.find({\r\n            model: modelFound._id\r\n        })\r\n        .sort({ cod_interno: 1})\r\n        .populate({\r\n            path: 'model',\r\n            select: 'name'\r\n        })\r\n        .populate({\r\n            path: 'createdBy',\r\n            select: 'name username'\r\n        })\r\n\r\n        if(query.length > 0){\r\n            res.json({total: query.length, all: query});\r\n        }else{\r\n            return res.status(404).json({message: `No se encontraron accesorios para ${modelo}`});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\nexport default accesorioController;"],"mappings":"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"}