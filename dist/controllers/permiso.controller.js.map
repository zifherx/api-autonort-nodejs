{"version":3,"file":"permiso.controller.js","names":["permisoController","getAll","req","res","Permiso","find","sort","cod_interno","populate","path","select","query","length","json","total","all","status","message","console","log","findBySubmodule","submodulo","body","SubmoduloG","findOne","name","submoduloFound","submoduloG","_id","one","createOne","rolesPermitidos","estado","obj","submoduleFound","Role","$in","roleFound","map","a","id","save","updateOneById","permisoId","params","subModuleFound","findByIdAndUpdate","deleteOneById","findByIdAndDelete"],"sources":["../../src/controllers/permiso.controller.js"],"sourcesContent":["import Permiso from '../models/Permiso';\r\nimport Role from '../models/Role';\r\nimport SubmoduloG from '../models/SubmoduloG';\r\n\r\nconst permisoController = {};\r\n\r\npermisoController.getAll = async(req, res) => {\r\n    try {\r\n        const query = await Permiso.find()\r\n        .sort({cod_interno: 1})\r\n        .populate({\r\n            path: 'submoduloG',\r\n            select: 'name estado moduloG',\r\n            populate: {\r\n                path: 'moduloG',\r\n                select: 'name icon menuG',\r\n                populate: {\r\n                    path: 'menuG',\r\n                    select: 'name icon'\r\n                }\r\n            }\r\n        })\r\n        .populate({\r\n            path: 'rolesPermitidos',\r\n            select: 'name descripcion'\r\n        })\r\n\r\n        if(query.length > 0){\r\n            res.json({total: query.length, all: query});\r\n        }else{\r\n            return res.status(404).json({message: 'No existen permisos'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});    \r\n    }\r\n}\r\n\r\npermisoController.findBySubmodule = async (req, res) => {\r\n    const {submodulo} = req.body;\r\n    try {\r\n\r\n        const submoduloFound = await SubmoduloG.findOne({name: submodulo});\r\n        // console.log(submoduloFound);\r\n        if(!submoduloFound) return res.status(404).json({message: `Submódulo ${submodulo} no encontrado`}) \r\n\r\n        const query = await Permiso.findOne({submoduloG: submoduloFound._id})\r\n        .populate({\r\n            path: 'submoduloG',\r\n            select: 'name'\r\n        })\r\n        .populate({\r\n            path: 'rolesPermitidos',\r\n            select: 'name descripcion'\r\n        });\r\n\r\n        if(query){\r\n            res.json({total: query.length, one: query});\r\n        }else{\r\n            return res.status(404).json({message: 'No existen permisos'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});   \r\n    }\r\n}\r\n\r\npermisoController.createOne = async(req, res) => {\r\n    const {cod_interno, submoduloG, rolesPermitidos,estado} = req.body;\r\n\r\n    try {\r\n        const obj = new Permiso({ cod_interno,estado});\r\n\r\n        const submoduleFound = await SubmoduloG.findOne({name: submoduloG});\r\n        if(!submoduleFound) return res.status(404).json({message: `Submódulo ${submoduloG} no encontrado`});\r\n        obj.submoduloG = submoduleFound._id;\r\n\r\n        const roleFound = await Role.find({name: {$in: rolesPermitidos}});\r\n        if(!roleFound) return res.status(404).json({message: `Rol ${rolesPermitidos} no encontrado`});\r\n        obj.rolesPermitidos = roleFound.map(a => a.id);\r\n\r\n        const query = await obj.save();\r\n\r\n        if(query){\r\n            res.json({message: 'Permiso creado con éxito'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\npermisoController.updateOneById = async(req, res) => {\r\n    const {cod_interno, submoduloG, rolesPermitidos,estado} = req.body;\r\n    const {permisoId} = req.params;\r\n\r\n    try {\r\n\r\n        const roleFound = await Role.find({name: {$in: rolesPermitidos}});\r\n        if(!roleFound) return res.status(404).json({message: `No se encontró el rol ${rolesPermitidos}`});\r\n\r\n        const subModuleFound = await SubmoduloG.findOne({name: submoduloG});\r\n        if(!subModuleFound) return res.status(404).json({message: `Submódulo ${submoduloG} no encontrado`})\r\n        \r\n        const query = await Permiso.findByIdAndUpdate(permisoId,{\r\n            cod_interno,\r\n            submoduloG: subModuleFound._id,\r\n            estado,\r\n            rolesPermitidos: roleFound.map(a => a._id)\r\n        });\r\n\r\n        if(query){\r\n            res.json({message: 'Permiso actualizado con éxito'});\r\n        }else{\r\n            return res.status(404).json({message: 'No existe permiso a actualizar'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\npermisoController.deleteOneById = async(req, res) => {\r\n    const {permisoId} = req.params;\r\n\r\n    try {\r\n        const query = await Permiso.findByIdAndDelete(permisoId);\r\n\r\n        if(query){\r\n            res.json({message: 'Permiso eliminado con éxito'});\r\n        }else{\r\n            return res.status(404).json({message: 'No existe permiso a eliminar'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\nexport default permisoController;"],"mappings":"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"}