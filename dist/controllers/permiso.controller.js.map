{"version":3,"file":"permiso.controller.js","names":["permisoController","getAll","req","res","Permiso","find","sort","cod_interno","populate","path","select","query","length","json","total","all","status","message","console","log","findBySubmodule","submodulo","body","SubmoduloG","findOne","name","submoduloFound","submoduloG","_id","one","findByCodigo","codigo","createOne","rolesPermitidos","estado","obj","submoduleFound","Role","$in","roleFound","map","a","id","save","updateOneById","permisoId","params","subModuleFound","findByIdAndUpdate","deleteOneById","findByIdAndDelete"],"sources":["../../src/controllers/permiso.controller.js"],"sourcesContent":["import Permiso from '../models/Permiso';\r\nimport Role from '../models/Role';\r\nimport SubmoduloG from '../models/SubmoduloG';\r\n\r\nconst permisoController = {};\r\n\r\npermisoController.getAll = async(req, res) => {\r\n    try {\r\n        const query = await Permiso.find()\r\n        .sort({cod_interno: 1})\r\n        .populate({\r\n            path: 'submoduloG',\r\n            select: 'name estado moduloG',\r\n            populate: {\r\n                path: 'moduloG',\r\n                select: 'name icon menuG',\r\n                populate: {\r\n                    path: 'menuG',\r\n                    select: 'name icon'\r\n                }\r\n            }\r\n        })\r\n        .populate({\r\n            path: 'rolesPermitidos',\r\n            select: 'name descripcion'\r\n        })\r\n\r\n        if(query.length > 0){\r\n            res.json({total: query.length, all: query});\r\n        }else{\r\n            return res.status(404).json({message: 'No existen permisos'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});    \r\n    }\r\n}\r\n\r\npermisoController.findBySubmodule = async (req, res) => {\r\n    const {submodulo} = req.body;\r\n    try {\r\n\r\n        const submoduloFound = await SubmoduloG.findOne({name: submodulo});\r\n        // console.log(submoduloFound);\r\n        if(!submoduloFound) return res.status(404).json({message: `Submódulo ${submodulo} no encontrado`}) \r\n\r\n        const query = await Permiso.findOne({submoduloG: submoduloFound._id})\r\n        .populate({\r\n            path: 'submoduloG',\r\n            select: 'name'\r\n        })\r\n        .populate({\r\n            path: 'rolesPermitidos',\r\n            select: 'name descripcion'\r\n        });\r\n\r\n        if(query){\r\n            res.json({total: query.length, one: query});\r\n        }else{\r\n            return res.status(404).json({message: 'No existen permisos'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});   \r\n    }\r\n}\r\n\r\npermisoController.findByCodigo = async (req, res) => {\r\n    const {codigo} = req.body;\r\n    try {\r\n\r\n        const query = await Permiso.findOne({cod_interno: codigo})\r\n        .populate({\r\n            path: 'submoduloG',\r\n            select: 'name'\r\n        })\r\n        .populate({\r\n            path: 'rolesPermitidos',\r\n            select: 'name descripcion'\r\n        });\r\n\r\n        if(query){\r\n            res.json({one: query});\r\n        }else{\r\n            return res.status(404).json({message: 'No existen permisos'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});   \r\n    }\r\n}\r\n\r\npermisoController.createOne = async(req, res) => {\r\n    const {cod_interno, submoduloG, rolesPermitidos,estado} = req.body;\r\n\r\n    try {\r\n        const obj = new Permiso({ cod_interno,estado});\r\n\r\n        const submoduleFound = await SubmoduloG.findOne({name: submoduloG});\r\n        if(!submoduleFound) return res.status(404).json({message: `Submódulo ${submoduloG} no encontrado`});\r\n        obj.submoduloG = submoduleFound._id;\r\n\r\n        const roleFound = await Role.find({name: {$in: rolesPermitidos}});\r\n        if(!roleFound) return res.status(404).json({message: `Rol ${rolesPermitidos} no encontrado`});\r\n        obj.rolesPermitidos = roleFound.map(a => a.id);\r\n\r\n        const query = await obj.save();\r\n\r\n        if(query){\r\n            res.json({message: 'Permiso creado con éxito'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({message: err.message});\r\n    }\r\n}\r\n\r\npermisoController.updateOneById = async(req, res) => {\r\n    const {cod_interno, submoduloG, rolesPermitidos,estado} = req.body;\r\n    const {permisoId} = req.params;\r\n\r\n    try {\r\n\r\n        const roleFound = await Role.find({name: {$in: rolesPermitidos}});\r\n        if(!roleFound) return res.status(404).json({message: `No se encontró el rol ${rolesPermitidos}`});\r\n\r\n        const subModuleFound = await SubmoduloG.findOne({name: submoduloG});\r\n        if(!subModuleFound) return res.status(404).json({message: `Submódulo ${submoduloG} no encontrado`})\r\n        \r\n        const query = await Permiso.findByIdAndUpdate(permisoId,{\r\n            cod_interno,\r\n            submoduloG: subModuleFound._id,\r\n            estado,\r\n            rolesPermitidos: roleFound.map(a => a._id)\r\n        });\r\n\r\n        if(query){\r\n            res.json({message: 'Permiso actualizado con éxito'});\r\n        }else{\r\n            return res.status(404).json({message: 'No existe permiso a actualizar'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\npermisoController.deleteOneById = async(req, res) => {\r\n    const {permisoId} = req.params;\r\n\r\n    try {\r\n        const query = await Permiso.findByIdAndDelete(permisoId);\r\n\r\n        if(query){\r\n            res.json({message: 'Permiso eliminado con éxito'});\r\n        }else{\r\n            return res.status(404).json({message: 'No existe permiso a eliminar'});\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\nexport default permisoController;"],"mappings":"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"}