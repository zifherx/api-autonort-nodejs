{"version":3,"file":"helper.controller.js","names":["helperController","enviarCorreo","req","res","body","to","cc","subject","text","estadoSolicitudMAF","observacion","motivo","ejecutivo_maf","nro_solicitud","titular","documento","estado_civil","centro_laboral","ingreso_promedio","cuota_inicial","cod_tdp","anio_fabricacion","anio_modelo","pvp","plan_solicitud","tipo_uso","vendedor","transporter","optionsTemplate","emailOptions","emailSent","nodemailer","createTransport","host","config","EMAIL_HOST","port","EMAIL_PORT_SMTP","secure","auth","user","EMAIL_USER","pass","EMAIL_PASS","viewEngine","extname","layoutsDir","defaultLayout","viewPath","extName","use","hbs","from","template","context","sendMail","respuesta","response","split","console","log","getTestMessageUrl","json","message","info","messageId","delay","envelopeTime","status"],"sources":["../../src/controllers/helper.controller.js"],"sourcesContent":["import nodemailer from \"nodemailer\";\r\nimport hbs from \"nodemailer-express-handlebars\";\r\nimport path from \"path\";\r\nimport config from '../config/config'\r\n\r\nconst helperController = {};\r\n\r\nhelperController.enviarCorreo = async (req, res) => {\r\n    const {\r\n        to,\r\n        cc,\r\n        subject,\r\n        text,\r\n        estadoSolicitudMAF,\r\n        observacion,\r\n        motivo,\r\n        ejecutivo_maf,\r\n        nro_solicitud,\r\n        titular,\r\n        documento,\r\n        estado_civil,\r\n        centro_laboral,\r\n        ingreso_promedio,\r\n        cuota_inicial,\r\n        cod_tdp,\r\n        anio_fabricacion,\r\n        anio_modelo,\r\n        pvp,\r\n        plan_solicitud,\r\n        tipo_uso,\r\n        vendedor\r\n    } = req.body;\r\n\r\n    let transporter = null;\r\n    let optionsTemplate = null;\r\n    let emailOptions = null;\r\n    let emailSent = null;\r\n\r\n    try {\r\n        transporter = nodemailer.createTransport({\r\n            host: config.EMAIL_HOST,\r\n            port: config.EMAIL_PORT_SMTP,\r\n            secure: true,\r\n            auth: {\r\n                user: config.EMAIL_USER,\r\n                pass: config.EMAIL_PASS,\r\n            },\r\n        });\r\n\r\n        if(estadoSolicitudMAF == 'INGRESADO'){\r\n\r\n            optionsTemplate = {\r\n                viewEngine: {\r\n                    extname: \".hbs\",\r\n                    layoutsDir: \"src/views\",\r\n                    defaultLayout: \"templateEmailMaf\",\r\n                },\r\n                viewPath: \"src/views\",\r\n                extName: \".hbs\",\r\n            };\r\n\r\n            transporter.use(\"compile\", hbs(optionsTemplate));\r\n\r\n            emailOptions = {\r\n                from: `\"Plataforma SCI ðŸ‘»\" <${config.EMAIL_USER}>`,\r\n                to,\r\n                cc,\r\n                subject,\r\n                text,\r\n                template: \"templateEmailMaf\",\r\n                context: {\r\n                    ejecutivo_maf,\r\n                    nro_solicitud,\r\n                    titular,\r\n                    documento,\r\n                    estado_civil,\r\n                    centro_laboral,\r\n                    ingreso_promedio,\r\n                    cuota_inicial,\r\n                    cod_tdp,\r\n                    anio_fabricacion,\r\n                    anio_modelo,\r\n                    pvp,\r\n                    plan_solicitud,\r\n                    tipo_uso,\r\n                    vendedor\r\n                },\r\n            };\r\n\r\n            emailSent = await transporter.sendMail(emailOptions);\r\n\r\n        }else{\r\n\r\n            optionsTemplate = {\r\n                viewEngine: {\r\n                    extname: \".hbs\",\r\n                    layoutsDir: \"src/views\",\r\n                    defaultLayout: \"templateEmailUpdateMaf\",\r\n                },\r\n                viewPath: \"src/views\",\r\n                extName: \".hbs\",\r\n            };\r\n\r\n            transporter.use(\"compile\", hbs(optionsTemplate));\r\n\r\n            emailOptions = {\r\n                from: `\"Plataforma SCI ðŸ‘»\" <${config.EMAIL_USER}>`,\r\n                to,\r\n                cc: [cc, \"frojas@autonortnor.com.pe\"],\r\n                subject,\r\n                text,\r\n                template: \"templateEmailUpdateMaf\",\r\n                context: {\r\n                    nro_solicitud,\r\n                    estadoSolicitudMAF,\r\n                    ejecutivo_maf,\r\n                    titular,\r\n                    documento,\r\n                    cod_tdp,\r\n                    plan_solicitud,\r\n                    vendedor,\r\n                    observacion,\r\n                    motivo\r\n                },\r\n            };\r\n\r\n            emailSent = await transporter.sendMail(emailOptions);\r\n        }\r\n\r\n        let respuesta = emailSent.response.split(\" \");\r\n\r\n        if (respuesta[1] == \"OK\") {\r\n            console.log(\"Preview URL: %s\", nodemailer.getTestMessageUrl(emailSent));\r\n            res.json({ message: \"Mensaje enviado\", info: emailSent.messageId, delay: emailSent.envelopeTime, response: emailSent.response });\r\n        } else {\r\n            return res.status(500).json({ message: \"Error al enviar correo\" });\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ message: err.message });\r\n    }\r\n};\r\n\r\nexport default helperController;\r\n"],"mappings":"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"}