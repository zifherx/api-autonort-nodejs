{"version":3,"sources":["../../src/controllers/helper.controller.js"],"names":["helperController","enviarCorreo","req","res","body","to","cc","subject","text","estadoSolicitudMAF","observacion","motivo","ejecutivo_maf","nro_solicitud","titular","documento","estado_civil","centro_laboral","ingreso_promedio","cuota_inicial","cod_tdp","anio_fabricacion","anio_modelo","pvp","plan_solicitud","tipo_uso","vendedor","transporter","optionsTemplate","emailOptions","emailSent","nodemailer","createTransport","host","config","EMAIL_HOST","port","EMAIL_PORT_SMTP","secure","auth","user","EMAIL_USER","pass","EMAIL_PASS","viewEngine","extname","layoutsDir","defaultLayout","viewPath","extName","use","from","template","context","sendMail","respuesta","response","split","console","log","getTestMessageUrl","json","message","info","messageId","delay","envelopeTime","status"],"mappings":"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","sourcesContent":["import nodemailer from \"nodemailer\";\r\nimport hbs from \"nodemailer-express-handlebars\";\r\nimport path from \"path\";\r\nimport config from '../config/config'\r\n\r\nconst helperController = {};\r\n\r\nhelperController.enviarCorreo = async (req, res) => {\r\n    const {\r\n        to,\r\n        cc,\r\n        subject,\r\n        text,\r\n        estadoSolicitudMAF,\r\n        observacion,\r\n        motivo,\r\n        ejecutivo_maf,\r\n        nro_solicitud,\r\n        titular,\r\n        documento,\r\n        estado_civil,\r\n        centro_laboral,\r\n        ingreso_promedio,\r\n        cuota_inicial,\r\n        cod_tdp,\r\n        anio_fabricacion,\r\n        anio_modelo,\r\n        pvp,\r\n        plan_solicitud,\r\n        tipo_uso,\r\n        vendedor\r\n    } = req.body;\r\n\r\n    let transporter = null;\r\n    let optionsTemplate = null;\r\n    let emailOptions = null;\r\n    let emailSent = null;\r\n\r\n    try {\r\n        transporter = nodemailer.createTransport({\r\n            host: config.EMAIL_HOST,\r\n            port: config.EMAIL_PORT_SMTP,\r\n            secure: true,\r\n            auth: {\r\n                user: config.EMAIL_USER,\r\n                pass: config.EMAIL_PASS,\r\n            },\r\n        });\r\n\r\n        if(estadoSolicitudMAF == 'INGRESADO'){\r\n\r\n            optionsTemplate = {\r\n                viewEngine: {\r\n                    extname: \".hbs\",\r\n                    layoutsDir: \"src/views\",\r\n                    defaultLayout: \"templateEmailMaf\",\r\n                },\r\n                viewPath: \"src/views\",\r\n                extName: \".hbs\",\r\n            };\r\n\r\n            transporter.use(\"compile\", hbs(optionsTemplate));\r\n\r\n            emailOptions = {\r\n                from: `\"Plataforma SCI ðŸ‘»\" <${config.EMAIL_USER}>`,\r\n                to,\r\n                cc,\r\n                subject,\r\n                text,\r\n                template: \"templateEmailMaf\",\r\n                context: {\r\n                    ejecutivo_maf,\r\n                    nro_solicitud,\r\n                    titular,\r\n                    documento,\r\n                    estado_civil,\r\n                    centro_laboral,\r\n                    ingreso_promedio,\r\n                    cuota_inicial,\r\n                    cod_tdp,\r\n                    anio_fabricacion,\r\n                    anio_modelo,\r\n                    pvp,\r\n                    plan_solicitud,\r\n                    tipo_uso,\r\n                    vendedor\r\n                },\r\n            };\r\n\r\n            emailSent = await transporter.sendMail(emailOptions);\r\n\r\n        }else{\r\n\r\n            optionsTemplate = {\r\n                viewEngine: {\r\n                    extname: \".hbs\",\r\n                    layoutsDir: \"src/views\",\r\n                    defaultLayout: \"templateEmailUpdateMaf\",\r\n                },\r\n                viewPath: \"src/views\",\r\n                extName: \".hbs\",\r\n            };\r\n\r\n            transporter.use(\"compile\", hbs(optionsTemplate));\r\n\r\n            emailOptions = {\r\n                from: `\"Plataforma SCI ðŸ‘»\" <${config.EMAIL_USER}>`,\r\n                to,\r\n                cc: [cc, \"frojas@autonortnor.com.pe\"],\r\n                subject,\r\n                text,\r\n                template: \"templateEmailUpdateMaf\",\r\n                context: {\r\n                    nro_solicitud,\r\n                    estadoSolicitudMAF,\r\n                    ejecutivo_maf,\r\n                    titular,\r\n                    documento,\r\n                    cod_tdp,\r\n                    plan_solicitud,\r\n                    vendedor,\r\n                    observacion,\r\n                    motivo\r\n                },\r\n            };\r\n\r\n            emailSent = await transporter.sendMail(emailOptions);\r\n        }\r\n\r\n        let respuesta = emailSent.response.split(\" \");\r\n\r\n        if (respuesta[1] == \"OK\") {\r\n            console.log(\"Preview URL: %s\", nodemailer.getTestMessageUrl(emailSent));\r\n            res.json({ message: \"Mensaje enviado\", info: emailSent.messageId, delay: emailSent.envelopeTime, response: emailSent.response });\r\n        } else {\r\n            return res.status(500).json({ message: \"Error al enviar correo\" });\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ message: err.message });\r\n    }\r\n};\r\n\r\nexport default helperController;\r\n"],"file":"helper.controller.js"}