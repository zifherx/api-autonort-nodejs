{"version":3,"sources":["../../src/controllers/maf.controller.js"],"names":["getAll","req","res","Maf","find","populate","query","length","json","status","message","console","log","getOneById","mafId","params","findById","obtenerRequestbyStatus","body","pasoaHot","primer_status_request","response","createRequest","nro_solicitud","fecha_ingreso","sucursal","cliente","vendedor","vehiculo","plan","tipo_uso","files","filePaths","map","file","push","location","obj","evidencias","Customer","name","clienteEncontrado","customer","a","_id","Seller","vendedorEncontrado","seller","b","Vehicle","cod_tdp","vehiculoEncontrado","car","c","save","objCreated","actualizarRequest","fecha_respuesta","observacion","motivo","findByIdAndUpdate","messsage","error","actualizarReqAprobada","fecha_aprobacion","carta_aprobacion","carta","carta_evidencia","requestaHot","cambioStatusByMaf","tercer_status_request","deleteRequest","findOneAndDelete","enviarCorreoSolicitud","to","cc","subject","text","html","transporter","nodemailer","createTransport","host","port","secure","auth","user","pass","sendMail","from","email","respuesta","split","getTestMessageUrl","info","messageId","retardo","envelopeTime"],"mappings":"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","sourcesContent":["import nodemailer from 'nodemailer'\r\nimport Customer from '../models/Customer'\r\nimport Maf from '../models/Maf'\r\nimport Seller from '../models/Seller'\r\nimport Vehicle from '../models/Vehicle'\r\n\r\nexport const getAll = async(req, res) => {\r\n    try {\r\n        const query = await Maf.find().populate('customer seller car')\r\n            // console.log(query)\r\n        if (query.length > 0) {\r\n            res.json(query)\r\n        } else {\r\n            return res.status(404).json({ message: 'No existen solicitudes' })\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\nexport const getOneById = async(req, res) => {\r\n    const { mafId } = req.params;\r\n\r\n    try {\r\n        const query = await Maf.findById(mafId).populate('customer seller car')\r\n            // console.log(query)\r\n        if (query) {\r\n            res.json(query)\r\n        } else {\r\n            return res.status(404).json({ message: 'No existen solicitudes' })\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\nexport const obtenerRequestbyStatus = async(req, res) => {\r\n    const { status, pasoaHot } = req.body\r\n    try {\r\n        const query = await Maf.find({ primer_status_request: status, pasoaHot: pasoaHot }).populate('car seller customer')\r\n            // console.log(query)\r\n        if (query.length > 0) {\r\n            res.json(query)\r\n        } else {\r\n            return res.status(404).json({ message: `No se encuentran solicitudes en ${status}` })\r\n        }\r\n    } catch (err) {\r\n        console.log(err.response)\r\n        return res.status(503).json({ message: err.message })\r\n\r\n    }\r\n}\r\n\r\nexport const createRequest = async(req, res) => {\r\n    const {\r\n        nro_solicitud,\r\n        fecha_ingreso,\r\n        sucursal,\r\n        cliente,\r\n        vendedor,\r\n        vehiculo,\r\n        plan,\r\n        tipo_uso,\r\n        primer_status_request\r\n    } = req.body\r\n    const files = req.files;\r\n\r\n    // console.log(req);\r\n\r\n    let filePaths = [];\r\n\r\n    try {\r\n\r\n        if (files.length === 0) return res.status(400).json({ message: 'Faltan los documentos' })\r\n\r\n        files.map((file) => {\r\n            filePaths.push(file.location);\r\n        })\r\n\r\n        const obj = new Maf({\r\n            nro_solicitud,\r\n            fecha_ingreso,\r\n            sucursal,\r\n            plan,\r\n            tipo_uso,\r\n            evidencias: filePaths,\r\n            primer_status_request\r\n        })\r\n\r\n        let clienteEncontrado = await Customer.find({ name: cliente })\r\n        obj.customer = clienteEncontrado.map(a => a._id)\r\n\r\n        let vendedorEncontrado = await Seller.find({ name: vendedor })\r\n        obj.seller = vendedorEncontrado.map(b => b._id)\r\n\r\n        let vehiculoEncontrado = await Vehicle.find({ cod_tdp: vehiculo })\r\n        obj.car = vehiculoEncontrado.map(c => c._id)\r\n\r\n        const objCreated = await obj.save()\r\n\r\n        if (objCreated) {\r\n            res.json({ message: 'Solicitud MAF creada con éxito' })\r\n        }\r\n\r\n    } catch (err) {\r\n        console.log(err.response)\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\nexport const actualizarRequest = async(req, res) => {\r\n    const { mafId } = req.params;\r\n    const {\r\n        primer_status_request,\r\n        fecha_respuesta,\r\n        observacion,\r\n        motivo,\r\n\r\n    } = req.body\r\n\r\n    try {\r\n        const obj = await Maf.findByIdAndUpdate(mafId, {\r\n            primer_status_request,\r\n            fecha_respuesta,\r\n            observacion,\r\n            motivo\r\n        })\r\n        if (obj) {\r\n            res.json({ message: 'Solicitud MAF actualizada con éxito' });\r\n        } else {\r\n            return res.status(404).json({ messsage: 'No existe Solicitud a actualizar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        return res.status(503).json({ error: err });\r\n    }\r\n}\r\n\r\nexport const actualizarReqAprobada = async(req, res) => {\r\n    const { mafId } = req.params;\r\n    const {\r\n        primer_status_request,\r\n        fecha_respuesta,\r\n        observacion,\r\n        fecha_aprobacion,\r\n        carta_aprobacion\r\n    } = req.body\r\n    const carta = req.file;\r\n\r\n    try {\r\n        const query = await Maf.findByIdAndUpdate(mafId, {\r\n            primer_status_request,\r\n            fecha_respuesta,\r\n            observacion,\r\n            fecha_aprobacion,\r\n            carta_aprobacion,\r\n            carta_evidencia: carta.location\r\n        })\r\n\r\n        if (query) {\r\n            res.json({ message: 'Solicitud MAF aprobada con éxito' });\r\n        } else {\r\n            return res.status(404).json({ messsage: 'No existe Solicitud a aprobar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        return res.status(503).json({ error: err });\r\n    }\r\n}\r\n\r\nexport const requestaHot = async(req, res) => {\r\n    const { mafId } = req.params;\r\n    const { pasoaHot } = req.body;\r\n\r\n    try {\r\n        const query = await Maf.findByIdAndUpdate(mafId, { pasoaHot });\r\n        if (query) {\r\n            res.json({ message: 'Solicitud MAF se actualizó con éxito' });\r\n        } else {\r\n            return res.status(404).json({ messsage: 'No existe Solicitud a actualizar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        return res.status(503).json({ error: err });\r\n    }\r\n}\r\n\r\nexport const cambioStatusByMaf = async(req, res) => {\r\n    const { mafId } = req.params;\r\n    const { tercer_status_request } = req.body;\r\n\r\n    try {\r\n        const query = await Maf.findByIdAndUpdate(mafId, { tercer_status_request });\r\n        if (query) {\r\n            res.json({ message: `Cambio de Status a ${tercer_status_request} con éxito` });\r\n        } else {\r\n            return res.status(404).json({ messsage: 'No existe Solicitud a actualizar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n        return res.status(503).json({ error: err });\r\n    }\r\n}\r\n\r\nexport const deleteRequest = async(req, res) => {\r\n    const { mafId } = req.params;\r\n\r\n    try {\r\n        const query = await Maf.findOneAndDelete(mafId);\r\n        if (query) {\r\n            res.json({ message: 'Solicitud eliminada con éxito' });\r\n        } else {\r\n            return res.status(404).json({ message: 'No existe la solicitud a eliminar' });\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}\r\n\r\nexport const enviarCorreoSolicitud = async(req, res) => {\r\n    const { to, cc, subject, text, html } = req.body\r\n\r\n    try {\r\n        const transporter = nodemailer.createTransport({\r\n            host: 'mail.autonortnor.com',\r\n            port: '465',\r\n            secure: true,\r\n            auth: {\r\n                user: 'sistemadv@autonortnor.com',\r\n                pass: 'k=q0mdgLo,QS'\r\n            }\r\n        })\r\n\r\n        let email = await transporter.sendMail({\r\n            from: '\"Sistema ADV 👻\" <sistemadv@autonortnor.com>',\r\n            to: to,\r\n            cc: cc,\r\n            subject: subject,\r\n            text: text,\r\n            html: html\r\n        })\r\n\r\n        let respuesta = email.response.split(\" \")\r\n            // console.log(respuesta)\r\n            // console.log(respuesta[1])\r\n        if (respuesta[1] == 'OK') {\r\n            console.log(\"Preview URL: %s\", nodemailer.getTestMessageUrl(email));\r\n            res.json({ message: 'Mensaje enviado', info: email.messageId, retardo: email.envelopeTime, respuesta: email.response })\r\n        } else {\r\n            return res.status(500).json({ message: 'Error al enviar correo' })\r\n        }\r\n    } catch (err) {\r\n        console.log(err.message)\r\n        return res.status(503).json({ message: err.message })\r\n    }\r\n}"],"file":"maf.controller.js"}