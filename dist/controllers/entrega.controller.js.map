{"version":3,"file":"entrega.controller.js","names":["entregaController","getAll","req","res","Entrega","find","sort","fecha_entrega","populate","path","select","query","length","json","total","all","status","message","console","log","createOne","body","observacion","tramite","hora_entrega","estadoEntrega","createdby","obj","Record","findById","mongoose","Types","ObjectId","tramiteFound","StatusEntrega","findOne","name","estadoFound","User","username","userFound","_id","createdBy","save"],"sources":["../../src/controllers/entrega.controller.js"],"sourcesContent":["import Entrega from \"../models/Entrega\";\r\nimport Record from \"../models/Record\";\r\nimport User from \"../models/User\";\r\nimport StatusEntrega from \"../models/StatusEntrega\";\r\nimport mongoose from \"mongoose\";\r\n\r\nconst entregaController = {};\r\n\r\nentregaController.getAll = async (req, res) => {\r\n\ttry {\r\n\t\tconst query = await Entrega.find()\r\n\t\t\t.sort({ fecha_entrega: -1 })\r\n\t\t\t.populate({\r\n\t\t\t\tpath: \"tramite\",\r\n\t\t\t\tselect: \"statusFile status_tarjeta status_placa sales\",\r\n\t\t\t\tpopulate: {\r\n\t\t\t\t\tpath: \"sales\",\r\n\t\t\t\t\tselect: \"vendedor cliente auto serie_tdp ubicacion_vehiculo fecha_entrega estatus_venta fecha_cancelacion estadoVentaE\",\r\n\t\t\t\t\tpopulate: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpath: \"vendedor\",\r\n\t\t\t\t\t\t\tselect: \"name\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpath: \"cliente\",\r\n\t\t\t\t\t\t\tselect: \"name\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpath: \"auto\",\r\n\t\t\t\t\t\t\tselect: \"cod_tdp version model\",\r\n\t\t\t\t\t\t\tpopulate: {\r\n\t\t\t\t\t\t\t\tpath: \"model\",\r\n\t\t\t\t\t\t\t\tselect: \"name avatar\",\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpath: \"estadoVentaE\",\r\n\t\t\t\t\t\t\tselect: \"name\",\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t\t.populate({\r\n\t\t\t\tpath: \"estadoEntrega\",\r\n\t\t\t\tselect: \"name value\",\r\n\t\t\t})\r\n\t\t\t.populate({\r\n\t\t\t\tpath: \"createdBy\",\r\n\t\t\t\tselect: \"name\",\r\n\t\t\t});\r\n\r\n\t\tif (query.length > 0) {\r\n\t\t\tres.json({ total: query.length, all: query });\r\n\t\t} else {\r\n\t\t\treturn res.status(404).json({ message: \"No existen entregas\" });\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\treturn res.status(503).json({ message: err.message });\r\n\t}\r\n};\r\n\r\nentregaController.createOne = async (req, res) => {\r\n\tconst { observacion, tramite, fecha_entrega, hora_entrega, estadoEntrega, createdby } = req.body;\r\n\t// console.log(req.body);\r\n\r\n\ttry {\r\n\t\tconst obj = new Entrega({ observacion, fecha_entrega, hora_entrega });\r\n\r\n\t\tconst tramiteFound = await Record.findById(new mongoose.Types.ObjectId(tramite));\r\n\t\tif (!tramiteFound) return res.status(404).json({ message: `Tramige ${tramite} no encontrado` });\r\n\r\n\t\tconst estadoFound = await StatusEntrega.findOne({ name: estadoEntrega });\r\n\t\tif (!estadoFound) return res.status(404).json({ message: `Estado ${estadoEntrega} no encontrado` });\r\n\r\n\t\tconst userFound = await User.findOne({ username: createdby });\r\n\t\tif (!userFound) return res.status(404).json({ message: `Usuario ${createdby} no encontrado` });\r\n\r\n\t\tobj.tramite = tramiteFound._id;\r\n\t\tobj.estadoEntrega = estadoFound._id;\r\n\t\tobj.createdBy = userFound._id;\r\n\r\n\t\t// console.log('OBJ:',obj);\r\n\r\n\t\tconst query = await obj.save();\r\n\r\n\t\tif (query) {\r\n\t\t\tres.json({ message: \"Entrega programada con Ã©xito\" });\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\treturn res.status(503).json({ message: err.message });\r\n\t}\r\n};\r\n\r\nexport default entregaController;\r\n"],"mappings":"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"}